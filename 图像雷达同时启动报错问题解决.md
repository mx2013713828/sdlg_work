# 图像点云推理同时启动报错问题解决历程
#### <p align = "center">马玉峰📜</p>

## 2023.11.22改动更新

### 添加线程锁，图像和点云推理两个线程上锁



### 更改点云拷贝方式，从传址改为深度拷贝。

```cpp
pcl::PointCloud<PointXYZIRT>::Ptr input_pointcloud(new pcl::PointCloud<PointXYZIRT>(*perception::lidars::Lidars::pointcloud_l));
```
-------------

## 错误一

### 核心已转储，错误定位在点云推理函数。

- 实验现象：

    - orin中使用yolov5、v8的GPU版本+点云，v5lite-tensorrt、v8tensorrt+点云都会报错，错误相同，定位为点云推理完成的后处理中，显存上的bndbox数组访问错误，实测其大小为0，正常应为非0数组。

- 解决方法：
    - 先将后处理后的结果从显存中转储到内存中，再进行后续的访问。

- 解决结果：
    - 此处报错不再发生

## 错误二

### 内存分配失败

- 实验现象

    - v8tensorrt + 点云推理，报错后gdb定位语句在
    ```cpp
    //cuda_pointpillar.cpp 98行。
    nms_pred.reserved(100)
    ```

- 解决方法

    - 未解决
- 解决结果 
    - 未解决


------
## 实验

服务器上：单独运行图像推理（v8tensorrt）无错误。
        单独运行点云推理，无报错（至少两天）

orin： 单独运行图像推理：无报错。
       单独运行点云推理：无报错（至少两天）
       运行点云与图像推理（v5lite-tensorRT）,错误，gdb调试段错误，返回空信息。
       单独运行图像推理，报错


